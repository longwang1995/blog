<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>使用nodejs + Puppeteer无头浏览器生成PDF | 一路向北</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/blog/logo.jpg">
    <meta name="description" content="个人博客">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="google" value="notranslate">
    
    <link rel="preload" href="/blog/assets/css/0.styles.b077c0a0.css" as="style"><link rel="preload" href="/blog/assets/js/app.914bfc34.js" as="script"><link rel="preload" href="/blog/assets/js/3.14329318.js" as="script"><link rel="preload" href="/blog/assets/js/1.5bc5bf25.js" as="script"><link rel="preload" href="/blog/assets/js/20.8bb05617.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.65a24dae.js"><link rel="prefetch" href="/blog/assets/js/11.b65455df.js"><link rel="prefetch" href="/blog/assets/js/12.3113d3f1.js"><link rel="prefetch" href="/blog/assets/js/13.de5344d6.js"><link rel="prefetch" href="/blog/assets/js/14.d3cd07ae.js"><link rel="prefetch" href="/blog/assets/js/15.8cbd5db7.js"><link rel="prefetch" href="/blog/assets/js/16.7fe4bee6.js"><link rel="prefetch" href="/blog/assets/js/17.d81428ba.js"><link rel="prefetch" href="/blog/assets/js/18.2c96a3fa.js"><link rel="prefetch" href="/blog/assets/js/19.8deaf26a.js"><link rel="prefetch" href="/blog/assets/js/21.c7755cde.js"><link rel="prefetch" href="/blog/assets/js/22.2d814b09.js"><link rel="prefetch" href="/blog/assets/js/23.48893586.js"><link rel="prefetch" href="/blog/assets/js/24.e37093b6.js"><link rel="prefetch" href="/blog/assets/js/25.213aabb9.js"><link rel="prefetch" href="/blog/assets/js/26.48fd3fd0.js"><link rel="prefetch" href="/blog/assets/js/27.895aed38.js"><link rel="prefetch" href="/blog/assets/js/28.c7a65a9b.js"><link rel="prefetch" href="/blog/assets/js/29.5e684d75.js"><link rel="prefetch" href="/blog/assets/js/30.e4511baf.js"><link rel="prefetch" href="/blog/assets/js/31.a2dca134.js"><link rel="prefetch" href="/blog/assets/js/32.c93cfcff.js"><link rel="prefetch" href="/blog/assets/js/33.26689a83.js"><link rel="prefetch" href="/blog/assets/js/34.fd9e4aaf.js"><link rel="prefetch" href="/blog/assets/js/35.6765ab66.js"><link rel="prefetch" href="/blog/assets/js/36.3b1852f6.js"><link rel="prefetch" href="/blog/assets/js/37.a2b207c4.js"><link rel="prefetch" href="/blog/assets/js/4.fbe9533d.js"><link rel="prefetch" href="/blog/assets/js/5.1d8f8356.js"><link rel="prefetch" href="/blog/assets/js/6.17f9c8a0.js"><link rel="prefetch" href="/blog/assets/js/7.25acd08f.js"><link rel="prefetch" href="/blog/assets/js/8.9b36972e.js"><link rel="prefetch" href="/blog/assets/js/9.f1a419a0.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.b077c0a0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-c0d124fa><div data-v-c0d124fa><div class="password-shadow password-wrapper-out" style="display:none;" data-v-30dff670 data-v-c0d124fa data-v-c0d124fa><h3 class="title" data-v-30dff670>一路向北</h3> <p class="description" data-v-30dff670>个人博客</p> <label id="box" class="inputBox" data-v-30dff670><input type="password" value="" data-v-30dff670> <span data-v-30dff670>Konck! Knock!</span> <button data-v-30dff670>OK</button></label> <div class="footer" data-v-30dff670><span data-v-30dff670><i class="iconfont reco-theme" data-v-30dff670></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-30dff670>vuePress-theme-reco</a></span> <span data-v-30dff670><i class="iconfont reco-copyright" data-v-30dff670></i> <a data-v-30dff670><!---->
          
        <!---->
        2023
      </a></span></div></div> <div class="hide" data-v-c0d124fa><header class="navbar" data-v-c0d124fa><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/logo.jpg" alt="一路向北" class="logo"> <span class="site-name">一路向北</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link"><i class="undefined"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/categories/技术分享/" class="nav-link"><i class="undefined"></i>
  技术分享
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/其他/" class="nav-link"><i class="undefined"></i>
  其他
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/DIY/" class="nav-link"><i class="undefined"></i>
  DIY
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/Echarts/" class="nav-link"><i class="undefined"></i>
  Echarts
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/前端/" class="nav-link"><i class="undefined"></i>
  前端
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/分享/" class="nav-link"><i class="undefined"></i>
  分享
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/电影/" class="nav-link"><i class="undefined"></i>
  电影
</a></li></ul></div></div><div class="nav-item"><a href="/blog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/blog/outh/" class="nav-link"><i class="iconfont reco-blog"></i>
  个人简介
</a></div><div class="nav-item"><a href="/blog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><a href="/blog/movie/" class="nav-link"><i class="iconfont reco-document"></i>
  片库
</a></div><div class="nav-item"><a href="https://github.com/longwang1995" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-c0d124fa></div> <aside class="sidebar" data-v-c0d124fa><div class="personal-info-wrapper" data-v-5c49c935 data-v-c0d124fa><img src="/blog/logo.jpg" alt="author-avatar" class="personal-img" data-v-5c49c935> <!----> <div class="num" data-v-5c49c935><div data-v-5c49c935><h3 data-v-5c49c935>21</h3> <h6 data-v-5c49c935>文章</h6></div> <div data-v-5c49c935><h3 data-v-5c49c935>20</h3> <h6 data-v-5c49c935>标签</h6></div></div> <ul class="social-links" data-v-5c49c935></ul> <hr data-v-5c49c935></div> <nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link"><i class="undefined"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/categories/技术分享/" class="nav-link"><i class="undefined"></i>
  技术分享
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/其他/" class="nav-link"><i class="undefined"></i>
  其他
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/DIY/" class="nav-link"><i class="undefined"></i>
  DIY
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/Echarts/" class="nav-link"><i class="undefined"></i>
  Echarts
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/前端/" class="nav-link"><i class="undefined"></i>
  前端
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/分享/" class="nav-link"><i class="undefined"></i>
  分享
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/电影/" class="nav-link"><i class="undefined"></i>
  电影
</a></li></ul></div></div><div class="nav-item"><a href="/blog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/blog/outh/" class="nav-link"><i class="iconfont reco-blog"></i>
  个人简介
</a></div><div class="nav-item"><a href="/blog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><a href="/blog/movie/" class="nav-link"><i class="iconfont reco-document"></i>
  片库
</a></div><div class="nav-item"><a href="https://github.com/longwang1995" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-30dff670 data-v-c0d124fa><h3 class="title" data-v-30dff670>使用nodejs + Puppeteer无头浏览器生成PDF</h3> <!----> <label id="box" class="inputBox" data-v-30dff670><input type="password" value="" data-v-30dff670> <span data-v-30dff670>Konck! Knock!</span> <button data-v-30dff670>OK</button></label> <div class="footer" data-v-30dff670><span data-v-30dff670><i class="iconfont reco-theme" data-v-30dff670></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-30dff670>vuePress-theme-reco</a></span> <span data-v-30dff670><i class="iconfont reco-copyright" data-v-30dff670></i> <a data-v-30dff670><!---->
          
        <!---->
        2023
      </a></span></div></div> <div data-v-c0d124fa><div data-v-c0d124fa><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">使用nodejs + Puppeteer无头浏览器生成PDF</h1> <div data-v-7b22c628><i class="iconfont reco-account" data-v-7b22c628><span data-v-7b22c628>龙旺</span></i> <i class="iconfont reco-date" data-v-7b22c628><span data-v-7b22c628>2021/12/22</span></i> <!----> <i class="tags iconfont reco-tag" data-v-7b22c628><span class="tag-item" data-v-7b22c628>node.js</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="初始化项目"><a href="#初始化项目" class="header-anchor">#</a> 初始化项目</h2> <p>初始化</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> init
<span class="token comment"># 然后一路回车就行</span>
</code></pre></div><p>安装依赖</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> puppeteer
</code></pre></div><h2 id="使用到的参数配置"><a href="#使用到的参数配置" class="header-anchor">#</a> 使用到的参数配置</h2> <h3 id="puppeteer-launch-options"><a href="#puppeteer-launch-options" class="header-anchor">#</a> Puppeteer.launch(options)</h3> <ul><li><p><code>options</code></p> <ul><li><code>args</code> <code>&lt;Array&lt;string&gt;&gt;</code> 传递给浏览器实例的其他参数。 这些参数可以参考 <a href="https://peter.sh/experiments/chromium-command-line-switches/" target="_blank" rel="noopener noreferrer">这里<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</li> <li><code>executablePath</code> <code>&lt;string&gt;</code> 可运行 Chromium 或 Chrome 可执行文件的路径，而不是绑定的 Chromium。如果安装了 <code>puppeteer-core</code> 就需要用到这个配置，否则不用</li></ul></li></ul> <h3 id="page-goto-url-options"><a href="#page-goto-url-options" class="header-anchor">#</a> page.goto(url[, options])</h3> <ul><li><p><code>options</code></p> <ul><li><p><code>timeout</code> <code>&lt;number&gt;</code> 跳转等待时间，单位是毫秒, 默认是 30 秒, 传 0 表示无限等待。</p></li> <li><p><code>waitUntil</code> <code>&lt;string|Array&lt;string&gt;&gt;</code> 满足什么条件认为页面跳转完成，默认是 <code>load</code> 事件触发时。指定事件数组，那么所有事件触发后才认为是跳转完成。事件包括：</p> <ul><li><code>load</code> - 页面的 load 事件触发时</li> <li><code>domcontentloaded</code> - 页面的 <code>DOMContentLoaded</code> 事件触发时</li> <li><code>networkidle0</code> - 不再有网络连接时触发（至少 500 毫秒后）</li> <li><code>networkidle2</code> - 只有 2 个网络连接时触发（至少 500 毫秒后）</li></ul></li></ul></li></ul> <h3 id="page-pdf-options"><a href="#page-pdf-options" class="header-anchor">#</a> page.pdf([options])</h3> <ul><li><p><code>options</code></p> <ul><li><p><code>path</code> <code>&lt;string&gt;</code> pdf 文件保存的路径。如果是相对路径，则相对当前路径。如果不指定路径，将不保存到硬盘。</p></li> <li><p><code>scale</code> <code>&lt;number&gt;</code> 页面渲染的缩放。默认是 1。缩放值必须介于 0.1 到 2 之间。</p></li> <li><p><code>displayHeaderFooter</code> <code>&lt;boolean&gt;</code> 显示页眉和页脚。默认是不显示</p></li> <li><p><code>headerTemplate</code> <code>&lt;string&gt;</code> 页眉的 <code>html</code> 模板，可以有这些变量：</p> <ul><li><code>date</code> - 格式化的日期</li> <li><code>title</code> - 网页标题</li> <li><code>url</code> - 网页地址</li> <li><code>pageNumber</code> - 当前页码</li> <li><code>totalPages</code> - 总页数</li></ul></li> <li><p><code>footerTemplate</code> 页脚的 <code>html</code> 模板。和页眉模板变量相同。</p></li> <li><p><code>printBackground</code> 是否打印背景图. 默认是 <code>false</code>。</p></li> <li><p><code>landscape</code> <code>&lt;boolean&gt;</code> 页面横向(?Paper orientation). 默认为 <code>false</code>.</p></li> <li><p><code>pageRanges</code> <code>&lt;string&gt;</code> 要输出的页码范围, 比如, '1-5, 8, 11-13'。默认是空字符串，表示全部页码。</p></li></ul></li></ul> <h2 id="主要代码"><a href="#主要代码" class="header-anchor">#</a> 主要代码</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;puppeteer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">args</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;--disable-edv-shm-usage&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;--no-sandbox&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:3000/#/pdf&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">waitUntil</span><span class="token operator">:</span> <span class="token string">&quot;networkidle0&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">pdf</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">&quot;A4&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">printBackground</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&quot;./pdf.pdf&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">displayHeaderFooter</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">margin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token string">&quot;80px&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">bottom</span><span class="token operator">:</span> <span class="token string">&quot;80px&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    headerTemplate<span class="token punctuation">,</span>
    headerTemplate<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>封面不需要 <code>margin</code> 这个时候问题就来了，如果给封面设置 <code>margin: 0</code> 的话会导致其他页面的边距也出问题。这个时候就要换种思路了。</p> <h2 id="使用-pdf-lib-来实现-pdf-合并"><a href="#使用-pdf-lib-来实现-pdf-合并" class="header-anchor">#</a> 使用 <code>pdf-lib</code> 来实现 pdf 合并</h2> <p>最终代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;puppeteer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> PDFDocument <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;pdf-lib&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs/promises&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">args</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;--disable-edv-shm-usage&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;--no-sandbox&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:3000/#/pdf&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">waitUntil</span><span class="token operator">:</span> <span class="token string">&quot;networkidle0&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> option <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">&quot;A4&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">printBackground</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;-webkit-print-color-adjust&quot;</span><span class="token operator">:</span> <span class="token string">&quot;exact&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">// 首先渲染出1，2封面页和最后一个背景，这里就是把最后一页背景挪到前面来和首页用同一种规则渲染。后面再合并到尾页去</span>
  <span class="token keyword">const</span> cover <span class="token operator">=</span> <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">pdf</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token operator">...</span>option<span class="token punctuation">,</span>
    <span class="token literal-property property">pageRanges</span><span class="token operator">:</span> <span class="token string">&quot;1-2&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">addStyleTag</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">&quot;.page {display:none}&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">pdf</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token operator">...</span>option<span class="token punctuation">,</span>
    <span class="token literal-property property">displayHeaderFooter</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">margin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token string">&quot;80px&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">bottom</span><span class="token operator">:</span> <span class="token string">&quot;80px&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    headerTemplate<span class="token punctuation">,</span>
    headerTemplate<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> pdfDoc <span class="token operator">=</span> <span class="token keyword">await</span> PDFDocument<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> coverDoc <span class="token operator">=</span> <span class="token keyword">await</span> PDFDocument<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>cover<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token punctuation">[</span>coverPage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> pdfDoc<span class="token punctuation">.</span><span class="token function">copyPages</span><span class="token punctuation">(</span>coverDoc<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token punctuation">[</span>bgPage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> pdfDoc<span class="token punctuation">.</span><span class="token function">copyPages</span><span class="token punctuation">(</span>coverDoc<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  pdfDoc<span class="token punctuation">.</span><span class="token function">addPage</span><span class="token punctuation">(</span>coverPage<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> mainDoc <span class="token operator">=</span> <span class="token keyword">await</span> PDFDocument<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;main&quot;</span><span class="token punctuation">,</span> mainDoc<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> mainDoc<span class="token punctuation">.</span><span class="token function">getPageCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>mainPage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> pdfDoc<span class="token punctuation">.</span><span class="token function">copyPages</span><span class="token punctuation">(</span>mainDoc<span class="token punctuation">,</span> <span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    pdfDoc<span class="token punctuation">.</span><span class="token function">addPage</span><span class="token punctuation">(</span>mainPage<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  pdfDoc<span class="token punctuation">.</span><span class="token function">addPage</span><span class="token punctuation">(</span>bgPage<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> pdfBytes <span class="token operator">=</span> <span class="token keyword">await</span> pdfDoc<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">&quot;./pdf.pdf&quot;</span><span class="token punctuation">,</span> pdfBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="table-跨页显示"><a href="#table-跨页显示" class="header-anchor">#</a> <code>table</code> 跨页显示</h2> <p>可以使用 <code>thead</code> 和 设置相关 CSS 来实现</p> <p>html</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- 通过这种布局结合css可以实现跨页显示，表头会自动添加到下一页 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thead</span><span class="token punctuation">&gt;</span></span>
    ...
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>thead</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span><span class="token punctuation">&gt;</span></span>
    ...
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>css</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">table thead</span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> table-header-group<span class="token punctuation">;</span>
  <span class="token property">break-inside</span><span class="token punctuation">:</span> avoid<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="headertemplate-和-footertemplate-注意事项"><a href="#headertemplate-和-footertemplate-注意事项" class="header-anchor">#</a> <code>headerTemplate</code> 和 <code>footerTemplate</code> 注意事项：</h2> <ol><li><p>需要设置 <code>margin</code> 参数来留出空间展示 <code>headerTemplate</code> 和 <code>footerTemplate</code></p></li> <li><p><code>headerTemplate</code> 和 <code>footerTemplate</code> 中不支持使用路径和 url 的形式调用图片资源，那如果需要展示 img 该怎么办呢？将 img 尽可能压缩后，转为 base64，放在 src 中，就可以正常显示。</p></li> <li><p><code>headerTemplate</code> 和 <code>footerTemplate</code> 不支持 css 的 <code>background</code>，如需进行丰富样式的页眉页脚设计，就需要把背景转为 img，再放进去。</p></li> <li><p><code>headerTemplate</code> 和 <code>footerTemplate</code> 设置的页眉和页脚，并不在 html 的 dom 流中，他们不属于<code>&lt;html/&gt;</code>也不属于<code>&lt;body/&gt;</code>，<code>html</code> 的 <code>dom</code> 会自动跳过这片区域，与 <code>word</code> 类似。因此无法在 <code>html</code> 文件中的 <code>css</code> 中控制其样式，只能将其样式写入 <code>Template</code> 的字符串中，作为行间样式。</p></li> <li><p><code>footerTemplate</code> 提供了默认的页码显示支持，将 <code>span</code> 标签的 <code>class</code> 设置为 <code>totalPages</code> 为总页数，设置为 <code>pageNumber</code> 为当前页数。除此之外其他地方无法获取页码</p></li></ol> <p>生成效果：
<embed type="application/pdf" width="100%" height="1000px" src="/blog/assets/CPD02997-1651909535703.pdf"></p></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最近更新时间: </span> <span class="time">2022/10/26 15:02:07</span></div></footer> <!----> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-bac73764 data-v-c0d124fa><li class="level-2" data-v-bac73764><a href="/blog/front/htmltopdf.html#初始化项目" class="sidebar-link reco-side-初始化项目" data-v-bac73764>初始化项目</a></li><li class="level-2" data-v-bac73764><a href="/blog/front/htmltopdf.html#使用到的参数配置" class="sidebar-link reco-side-使用到的参数配置" data-v-bac73764>使用到的参数配置</a></li><li class="level-3" data-v-bac73764><a href="/blog/front/htmltopdf.html#puppeteer-launch-options" class="sidebar-link reco-side-puppeteer-launch-options" data-v-bac73764>Puppeteer.launch(options)</a></li><li class="level-3" data-v-bac73764><a href="/blog/front/htmltopdf.html#page-goto-url-options" class="sidebar-link reco-side-page-goto-url-options" data-v-bac73764>page.goto(url[, options])</a></li><li class="level-3" data-v-bac73764><a href="/blog/front/htmltopdf.html#page-pdf-options" class="sidebar-link reco-side-page-pdf-options" data-v-bac73764>page.pdf([options])</a></li><li class="level-2" data-v-bac73764><a href="/blog/front/htmltopdf.html#主要代码" class="sidebar-link reco-side-主要代码" data-v-bac73764>主要代码</a></li><li class="level-2" data-v-bac73764><a href="/blog/front/htmltopdf.html#使用-pdf-lib-来实现-pdf-合并" class="sidebar-link reco-side-使用-pdf-lib-来实现-pdf-合并" data-v-bac73764>使用 pdf-lib 来实现 pdf 合并</a></li><li class="level-2" data-v-bac73764><a href="/blog/front/htmltopdf.html#table-跨页显示" class="sidebar-link reco-side-table-跨页显示" data-v-bac73764>table 跨页显示</a></li><li class="level-2" data-v-bac73764><a href="/blog/front/htmltopdf.html#headertemplate-和-footertemplate-注意事项" class="sidebar-link reco-side-headertemplate-和-footertemplate-注意事项" data-v-bac73764>headerTemplate 和 footerTemplate 注意事项：</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-2a01419c data-v-2a01419c><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-2a01419c><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-2a01419c></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-2a01419c></path></svg></div></div></div>
    <script src="/blog/assets/js/app.914bfc34.js" defer></script><script src="/blog/assets/js/3.14329318.js" defer></script><script src="/blog/assets/js/1.5bc5bf25.js" defer></script><script src="/blog/assets/js/20.8bb05617.js" defer></script>
  </body>
</html>
